local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "DucWare — Anime Saga",
    Icon = 0,
    LoadingTitle = "Wait a minute, the script is loading",
    LoadingSubtitle = "by DucWare",
    Theme = "Amethyst",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "DucWare",
        FileName = "DucWareZ"
    },
    Discord = {
        Enabled = true,
        Invite = "PnHj485p",
        RememberJoins = false
    },
    KeySystem = true,
    KeySettings = {
        Title = "Get Key",
        Subtitle = "Key System",
        Note = "Key: DucWare",
        FileName = "Key",
        SaveKey = true,
        Key = {"DucWare"}
    }
})

Rayfield:Notify({
    Title = "Enjoy",
    Content = "Have Fun :)",
    Duration = 5,
    Image = "number"
})

local LobbyTab = Window:CreateTab("Lobby", 4483362458)
local GameTab = Window:CreateTab("Game", 4483362458)

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CodesEvent = ReplicatedStorage:WaitForChild("Event"):WaitForChild("Codes")

local codeList = {"Release", "SorryForDelay", "SorryForShutdown"}

LobbyTab:CreateButton({
    Name = "Redeem All Codes (Final)",
    Callback = function()
        local index = 1

        local function redeemNext()
            if index > #codeList then
                Rayfield:Notify({
                    Title = "✅ Hoàn tất",
                    Content = "Đã thử redeem toàn bộ mã.",
                    Duration = 4
                })
                return
            end

            local code = codeList[index]
            print("🔁 Đang thử mã:", code)

            -- Kết nối chờ phản hồi
            local received = false
            local connection
            connection = CodesEvent.OnClientEvent:Connect(function(response)
                received = true
                connection:Disconnect()

                Rayfield:Notify({
                    Title = "📨 Mã: " .. code,
                    Content = "Phản hồi: " .. tostring(response),
                    Duration = 3
                })

                index += 1
                task.wait(1.2)
                redeemNext()
            end)

            -- Gửi mã
            local ok, err = pcall(function()
                CodesEvent:FireServer(code)
            end)

            if not ok then
                connection:Disconnect()
                Rayfield:Notify({
                    Title = "❌ Không gửi được",
                    Content = code .. ": " .. tostring(err),
                    Duration = 3
                })
                index += 1
                task.wait(1.2)
                redeemNext()
            else
                -- Timeout nếu không có phản hồi sau 3 giây
                task.delay(3, function()
                    if not received then
                        if connection.Connected then
                            connection:Disconnect()
                        end
                        Rayfield:Notify({
                            Title = "⚠️ Không phản hồi từ server",
                            Content = "Mã \"" .. code .. "\" có thể đã gửi, nhưng server không trả về kết quả.",
                            Duration = 4
                        })
                        index += 1
                        redeemNext()
                    end
                end)
            end
        end

        redeemNext()
    end
})

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

GameTab:CreateToggle({
    Name = "Bay đánh quái (Auto)",
    Callback = function()
        local mobs = workspace:WaitForChild("Enemy"):GetChildren()

        for _, mob in pairs(mobs) do
            if mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
                -- Bay đến gần mob
                HumanoidRootPart.CFrame = mob.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)
                task.wait(0.5)

                -- Giả lập đánh, nếu game có RemoteEvent để đánh thì thay thế ở đây
                local attackRemote = ReplicatedStorage:FindFirstChild("Event") and ReplicatedStorage.Event:FindFirstChild("Attack")
                if attackRemote then
                    attackRemote:FireServer(mob)
                else
                    print("Không tìm thấy Remote để tấn công.")
                end

                -- Đợi 1 chút rồi chuyển sang quái khác
                task.wait(1)
            end
        end

        Rayfield:Notify({
            Title = "✔️ Hoàn tất",
            Content = "Đã tấn công toàn bộ quái khả dụng.",
            Duration = 4
        })
    end
})
