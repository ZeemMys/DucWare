-- ‚ö†Ô∏è Kh·ªüi t·∫°o th∆∞ vi·ªán Fluent GUI
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local Window = Fluent:CreateWindow({
    Title = "DucWare",
    SubTitle = "by Duck (Thanks To Fluent GUI)",
    TabWidth = 160,
    Size = UDim2.fromOffset(570, 440),
    Acrylic = true,
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Lobby = Window:AddTab({ Title = "Lobby", Icon = "box" }),
    Game = Window:AddTab({ Title = "Game", Icon = "swords" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

Fluent:Notify({
    Title = "Ch√†o m·ª´ng",
    Content = "AnimeSaga Script ƒê√É CH·∫†Y",
    Duration = 6
})

------------------ LOBBY --------------------
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local SellEvent = ReplicatedStorage:FindFirstChild("Event")
    and ReplicatedStorage.Event:FindFirstChild("ItemIven")
    and ReplicatedStorage.Event.ItemIven:FindFirstChild("Sell")

local selectedRarities = {}
local autoSellRunning = false

Tabs.Lobby:AddDropdown("RarityDropdown", {
    Title = "Ch·ªçn ƒë·ªô hi·∫øm ƒë·ªÉ Auto Sell",
    Values = {"Rare", "Epic", "Legendary", "Mythic"},
    Multi = true,
    Default = {},
    Callback = function(values)
        selectedRarities = {}
        for _, rarity in ipairs(values) do
            selectedRarities[rarity] = true
        end
    end
})

Tabs.Lobby:AddToggle("AutoSellToggle", {
    Title = "Auto Sell",
    Default = false,
    Callback = function(state)
        autoSellRunning = state
        if state then
            task.spawn(function()
                while autoSellRunning do
                    for rarity in pairs(selectedRarities) do
                        if SellEvent then
                            pcall(function()
                                SellEvent:FireServer(rarity)
                            end)
                        end
                    end
                    task.wait(2)
                end
            end)
        end
    end
})

------------------ GAME TAB --------------------
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- üîò SAFE MOUSE CLICK (n·∫øu c√≥)
local function safeClick()
    if typeof(mouse1press) == "function" and typeof(mouse1release) == "function" then
        mouse1press()
        task.wait(0.05)
        mouse1release()
    else
        -- N·∫øu kh√¥ng c√≥ mouse1press, d√πng VirtualInputManager
        VirtualInputManager:SendMouseButtonEvent(500, 500, 0, true, game, 0)
        task.wait(0.05)
        VirtualInputManager:SendMouseButtonEvent(500, 500, 0, false, game, 0)
    end
end

-- ‚öî AUTO START
local autoStart = false
Tabs.Game:AddToggle("AutoStart", {
    Title = "‚öî Auto Start",
    Default = false,
    Callback = function(state)
        autoStart = state
        if state then
            task.spawn(function()
                while autoStart do
                    local gui = PlayerGui:FindFirstChild("RoomUi")
                    local btn = gui and gui:FindFirstChild("Ready")
                        and gui.Ready:FindFirstChild("Frame")
                        and gui.Ready.Frame:FindFirstChild("StartButton")
                    if btn and btn:IsA("ImageButton") and btn.Visible then
                        local pos = btn.AbsolutePosition
                        local size = btn.AbsoluteSize
                        local centerX, centerY = pos.X + size.X / 2, pos.Y + size.Y / 2

                        VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, true, game, 1)
                        task.wait(0.05)
                        VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, false, game, 1)
                    end
                    task.wait(2)
                end
            end)
        end
    end
})

-- ‚öî AUTO FARM BAY V√íNG + TELE SAU KHI B·ªä ƒê√ÅNH
local autoFarm = false
local lastHp = nil
Tabs.Game:AddToggle("AutoFarm", {
    Title = "‚öî Auto Farm",
    Default = false,
    Callback = function(value)
        autoFarm = value
        if autoFarm then
            task.spawn(function()
                while autoFarm do
                    local myChar = LocalPlayer.Character
                    local mobs = workspace:FindFirstChild("Enemy") and workspace.Enemy:FindFirstChild("Mob")
                    if myChar and myChar:FindFirstChild("HumanoidRootPart") and mobs then
                        local hrp = myChar.HumanoidRootPart
                        local humanoid = myChar:FindFirstChild("Humanoid")
                        if humanoid then
                            for _, mob in ipairs(mobs:GetChildren()) do
                                if not autoFarm then break end
                                if mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
                                    local mobHRP = mob.HumanoidRootPart

                                    -- Bay v√≤ng quanh qu√°i
                                    local angle = 0
                                    for _ = 1, 20 do
                                        if not autoFarm then break end
                                        local radius = 5
                                        angle = angle + math.rad(30)
                                        local offset = CFrame.new(math.cos(angle) * radius, 0, math.sin(angle) * radius)
                                        local flyPos = mobHRP.CFrame * offset
                                        hrp.CFrame = flyPos

                                        -- T·∫•n c√¥ng th∆∞·ªùng
                                        safeClick()

                                        -- N·∫øu b·ªã m·∫•t m√°u ‚Üí tele ra sau qu√°i
                                        if lastHp and humanoid.Health < lastHp then
                                            local behind = mobHRP.CFrame * CFrame.new(0, 0, -3)
                                            myChar:PivotTo(behind)
                                        end
                                        lastHp = humanoid.Health

                                        task.wait(0.1)
                                    end
                                end
                            end
                        end
                    end
                    task.wait(0.2)
                end
            end)
        end
    end
})

---------------- SETTINGS -----------------

InterfaceManager:SetLibrary(Fluent)
SaveManager:SetLibrary(Fluent)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("FluentScriptHub")
SaveManager:SetFolder("FluentScriptHub/AnimeSaga")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)

Fluent:Notify({
    Title = "‚úÖ DucWare ƒë√£ ch·∫°y",
    Content = "M·ªçi ch·ª©c nƒÉng ƒë√£ load xong!",
    Duration = 6
})

SaveManager:LoadAutoloadConfig()
